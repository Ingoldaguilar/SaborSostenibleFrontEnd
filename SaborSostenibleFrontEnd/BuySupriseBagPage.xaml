<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SaborSostenibleFrontEnd.BuySupriseBagPage"
             Title="Bolsa Sorpresa"
             Background="{StaticResource backgroundColor}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" BackgroundColor="{StaticResource Primary}" Padding="20,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" 
                    Text="←" 
                    BackgroundColor="Transparent" 
                    TextColor="{StaticResource White}"
                    FontSize="24"
                    x:Name="BackButton"/>

            <Label Grid.Column="1" 
                   Text="McDonald's" 
                   FontSize="18" 
                   FontAttributes="Bold"
                   TextColor="{StaticResource White}"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"/>

            <Image Grid.Column="2"
                   Source="mcdonaldlogo.png"
                   WidthRequest="40"
                   HeightRequest="40"
                   Aspect="AspectFit"/>
        </Grid>

        <!-- Main Content -->
        <ScrollView Grid.Row="1">
            <StackLayout x:Name="MainContent" Padding="20">

                <!-- Step Indicator -->
                <Grid x:Name="StepIndicator" Margin="0,10,0,30">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Step 1 -->
                    <StackLayout Grid.Column="0" HorizontalOptions="Center">
                        <Frame x:Name="Step1Circle" 
                               WidthRequest="30" 
                               HeightRequest="30" 
                               CornerRadius="15" 
                               BackgroundColor="{StaticResource Primary}"
                               HasShadow="False"
                               Padding="0">
                            <Label Text="1" 
                                   TextColor="{StaticResource White}" 
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Frame>
                        <Label Text="Compra" FontSize="10" HorizontalOptions="Center"/>
                    </StackLayout>

                    <!-- Step 2 -->
                    <StackLayout Grid.Column="1" HorizontalOptions="Center">
                        <Frame x:Name="Step2Circle" 
                               WidthRequest="30" 
                               HeightRequest="30" 
                               CornerRadius="15" 
                               BackgroundColor="{StaticResource Secondary}"
                               HasShadow="False"
                               Padding="0">
                            <Label Text="2" 
                                   TextColor="{StaticResource Primary}" 
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Frame>
                        <Label Text="Pago" FontSize="10" HorizontalOptions="Center"/>
                    </StackLayout>

                    <!-- Step 3 -->
                    <StackLayout Grid.Column="2" HorizontalOptions="Center">
                        <Frame x:Name="Step3Circle" 
                               WidthRequest="30" 
                               HeightRequest="30" 
                               CornerRadius="15" 
                               BackgroundColor="{StaticResource Secondary}"
                               HasShadow="False"
                               Padding="0">
                            <Label Text="3" 
                                   TextColor="{StaticResource Primary}" 
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Frame>
                        <Label Text="Comprobante" FontSize="10" HorizontalOptions="Center"/>
                    </StackLayout>

                    <!-- Step 4 -->
                    <StackLayout Grid.Column="3" HorizontalOptions="Center">
                        <Frame x:Name="Step4Circle" 
                               WidthRequest="30" 
                               HeightRequest="30" 
                               CornerRadius="15" 
                               BackgroundColor="{StaticResource Secondary}"
                               HasShadow="False"
                               Padding="0">
                            <Label Text="4" 
                                   TextColor="{StaticResource Primary}" 
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Frame>
                        <Label Text="Espera" FontSize="10" HorizontalOptions="Center"/>
                    </StackLayout>
                </Grid>

                <!-- Step 1: Shopping -->
                <StackLayout x:Name="ShoppingStep" IsVisible="True">

                    <!-- Product Card -->
                    <Frame BackgroundColor="{StaticResource White}" 
                           CornerRadius="12" 
                           HasShadow="True" 
                           Padding="20"
                           Margin="0,10">

                        <StackLayout>
                            <!-- Product Header -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Frame Grid.Column="0" 
                                       BackgroundColor="{StaticResource Tertiary}" 
                                       WidthRequest="60" 
                                       HeightRequest="60" 
                                       CornerRadius="30"
                                       HasShadow="False"
                                       Padding="0">
                                    <Label Text="🎁" 
                                           FontSize="30" 
                                           HorizontalOptions="Center" 
                                           VerticalOptions="Center"/>
                                </Frame>

                                <StackLayout Grid.Column="1" Padding="15,0,0,0">
                                    <Label Text="Bolsa Sorpresa McDonald's" 
                                           FontSize="18" 
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource Primary}"/>
                                    <Label Text="¡Una deliciosa sorpresa te espera!" 
                                           FontSize="14" 
                                           TextColor="Gray"/>
                                </StackLayout>

                                <Frame Grid.Column="2" 
                                       BackgroundColor="{StaticResource Primary}" 
                                       CornerRadius="15"
                                       HasShadow="False"
                                       Padding="8,4">
                                    <Label Text="30% OFF" 
                                           TextColor="{StaticResource White}" 
                                           FontSize="12" 
                                           FontAttributes="Bold"/>
                                </Frame>
                            </Grid>

                            <!-- Product Description -->
                            <StackLayout Margin="0,15,0,0">
                                <Label Text="🍟 Contenido variado de productos McDonald's" FontSize="14" TextColor="Gray"/>
                                <Label Text="🎁 Valor superior al precio de venta" FontSize="14" TextColor="Gray"/>
                                <Label Text="⭐ Productos frescos del día" FontSize="14" TextColor="Gray"/>
                                <Label Text="📦 Empaque ecológico" FontSize="14" TextColor="Gray"/>
                            </StackLayout>

                            <!-- Price -->
                            <Grid Margin="0,15,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackLayout Grid.Column="0" Orientation="Horizontal">
                                    <Label Text="₡3.500" 
                                           FontSize="24" 
                                           FontAttributes="Bold" 
                                           TextColor="{StaticResource Tertiary}"/>
                                    <Label Text="₡5.000" 
                                           FontSize="16" 
                                           TextColor="Gray" 
                                           TextDecorations="Strikethrough"
                                           VerticalOptions="Center"
                                           Margin="10,0,0,0"/>
                                </StackLayout>
                            </Grid>
                        </StackLayout>
                    </Frame>

                    <!-- Customer Phone Input -->
                    <StackLayout Margin="0,20,0,0">
                        <Label Text="Tu número de teléfono:" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"/>
                        <Entry x:Name="CustomerPhoneEntry" 
                               Placeholder="8888-8888" 
                               Keyboard="Telephone"
                               BackgroundColor="{StaticResource White}"
                               TextColor="{StaticResource Black}"
                               Margin="0,5,0,0"/>
                    </StackLayout>

                    <!-- Purchase Button -->
                    <Button x:Name="PurchaseButton" 
                            Text="Comprar Bolsa Sorpresa" 
                            BackgroundColor="{StaticResource Tertiary}"
                            TextColor="{StaticResource White}"
                            FontAttributes="Bold"
                            CornerRadius="8"
                            Padding="15"
                            Margin="0,30,0,0"
                            Clicked="OnPurchaseClicked"/>
                </StackLayout>

                <!-- Step 2: Payment -->
                <StackLayout x:Name="PaymentStep" IsVisible="False">

                    <StackLayout HorizontalOptions="Center" Margin="0,20,0,0">
                        <Frame BackgroundColor="{StaticResource Primary}" 
                               WidthRequest="80" 
                               HeightRequest="80" 
                               CornerRadius="40"
                               HasShadow="False"
                               HorizontalOptions="Center">
                            <Label Text="📱" 
                                   FontSize="40" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center"/>
                        </Frame>

                        <Label Text="Pago con SINPE Móvil" 
                               FontSize="22" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"
                               HorizontalOptions="Center"
                               Margin="0,10,0,0"/>
                    </StackLayout>

                    <!-- Payment Details Card -->
                    <Frame BackgroundColor="{StaticResource White}" 
                           CornerRadius="12" 
                           HasShadow="True" 
                           Padding="20"
                           Margin="0,20">

                        <StackLayout>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackLayout Grid.Column="0">
                                    <Label Text="Código de orden:" 
                                           FontSize="12" 
                                           TextColor="Gray"/>
                                    <Label x:Name="OrderCodeLabel" 
                                           Text="MCDS123456" 
                                           FontSize="18" 
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource Tertiary}"/>
                                </StackLayout>

                                <StackLayout Grid.Column="1">
                                    <Label Text="Monto:" 
                                           FontSize="12" 
                                           TextColor="Gray"/>
                                    <Label Text="₡3.500" 
                                           FontSize="18" 
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource Tertiary}"/>
                                </StackLayout>
                            </Grid>

                            <BoxView HeightRequest="1" 
                                     Color="{StaticResource Secondary}" 
                                     Margin="0,15"/>

                            <StackLayout>
                                <Label Text="Enviar SINPE Móvil a:" 
                                       FontSize="12" 
                                       TextColor="Gray"/>
                                <Label Text="8888-8888" 
                                       FontSize="20" 
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource Primary}"/>
                            </StackLayout>

                            <StackLayout Margin="0,15,0,0">
                                <Label Text="Detalle del pago:" 
                                       FontSize="12" 
                                       TextColor="Gray"/>
                                <Label x:Name="PaymentDetailLabel" 
                                       Text="Compra bolsa MCDS123456" 
                                       FontSize="14" 
                                       FontAttributes="Bold"/>
                            </StackLayout>
                        </StackLayout>
                    </Frame>

                    <!-- Payment Buttons -->
                    <Button x:Name="OpenSinpeButton" 
                            Text="Abrir SINPE Móvil" 
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="{StaticResource White}"
                            FontAttributes="Bold"
                            CornerRadius="8"
                            Padding="15"
                            Margin="0,10,0,0"
                            Clicked="OnOpenSinpeClicked"/>

                    <Button x:Name="PaymentSentButton" 
                            Text="Ya envié el pago" 
                            BackgroundColor="Transparent"
                            TextColor="{StaticResource Primary}"
                            BorderColor="{StaticResource Secondary}"
                            BorderWidth="2"
                            FontAttributes="Bold"
                            CornerRadius="8"
                            Padding="15"
                            Margin="0,10,0,0"
                            Clicked="OnPaymentSentClicked"/>
                </StackLayout>

                <!-- Step 3: Receipt -->
                <StackLayout x:Name="ReceiptStep" IsVisible="False">

                    <StackLayout HorizontalOptions="Center" Margin="0,20,0,0">
                        <Frame BackgroundColor="{StaticResource Tertiary}" 
                               WidthRequest="80" 
                               HeightRequest="80" 
                               CornerRadius="40"
                               HasShadow="False"
                               HorizontalOptions="Center">
                            <Label Text="📄" 
                                   FontSize="40" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center"/>
                        </Frame>

                        <Label Text="Enviar Comprobante" 
                               FontSize="22" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"
                               HorizontalOptions="Center"
                               Margin="0,10,0,0"/>
                    </StackLayout>

                    <!-- Receipt Instructions -->
                    <Frame BackgroundColor="{StaticResource White}" 
                           CornerRadius="12" 
                           HasShadow="True" 
                           Padding="20"
                           Margin="0,20">

                        <StackLayout>
                            <Label Text="Para completar tu compra, envía el comprobante de SINPE Móvil por WhatsApp al número:" 
                                   FontSize="16" 
                                   TextColor="Gray"
                                   HorizontalTextAlignment="Center"/>

                            <StackLayout HorizontalOptions="Center" Margin="0,15,0,0">
                                <Label Text="8888-8888" 
                                       FontSize="24" 
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource Primary}"
                                       HorizontalOptions="Center"/>
                            </StackLayout>

                            <Frame BackgroundColor="{StaticResource backgroundColor}" 
                                   CornerRadius="8" 
                                   HasShadow="False"
                                   Padding="15"
                                   Margin="0,15,0,0">
                                <StackLayout>
                                    <Label Text="Incluye en el mensaje:" 
                                           FontSize="14" 
                                           FontAttributes="Bold"/>
                                    <Label x:Name="WhatsAppMessageLabel" 
                                           Text="Comprobante bolsa sorpresa MCDS123456" 
                                           FontSize="12" 
                                           TextColor="Gray"/>
                                </StackLayout>
                            </Frame>
                        </StackLayout>
                    </Frame>

                    <!-- WhatsApp Button -->
                    <Button x:Name="SendWhatsAppButton" 
                            Text="Enviar por WhatsApp" 
                            BackgroundColor="#25D366"
                            TextColor="{StaticResource White}"
                            FontAttributes="Bold"
                            CornerRadius="8"
                            Padding="15"
                            Margin="0,10,0,0"
                            Clicked="OnSendWhatsAppClicked"/>

                    <Button x:Name="ReceiptSentButton" 
                            Text="Ya envié el comprobante" 
                            BackgroundColor="{StaticResource Secondary}"
                            TextColor="{StaticResource Primary}"
                            FontAttributes="Bold"
                            CornerRadius="8"
                            Padding="15"
                            Margin="0,10,0,0"
                            Clicked="OnReceiptSentClicked"/>
                </StackLayout>

                <!-- Step 4: Waiting -->
                <StackLayout x:Name="WaitingStep" IsVisible="False">

                    <StackLayout HorizontalOptions="Center" Margin="0,20,0,0">
                        <Frame BackgroundColor="{StaticResource Secondary}" 
                               WidthRequest="80" 
                               HeightRequest="80" 
                               CornerRadius="40"
                               HasShadow="False"
                               HorizontalOptions="Center">
                            <Label Text="⏰" 
                                   FontSize="40" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center"/>
                        </Frame>

                        <Label Text="En Espera de Confirmación" 
                               FontSize="22" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               Margin="0,10,0,0"/>
                    </StackLayout>

                    <!-- Waiting Details -->
                    <Frame BackgroundColor="{StaticResource White}" 
                           CornerRadius="12" 
                           HasShadow="True" 
                           Padding="20"
                           Margin="0,20">

                        <StackLayout>
                            <StackLayout HorizontalOptions="Center">
                                <Label Text="Tu código de orden:" 
                                       FontSize="12" 
                                       TextColor="Gray"
                                       HorizontalOptions="Center"/>
                                <Label x:Name="WaitingOrderCodeLabel" 
                                       Text="MCDS123456" 
                                       FontSize="20" 
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource Tertiary}"
                                       HorizontalOptions="Center"/>
                            </StackLayout>

                            <Label Text="Tu pago está siendo verificado por nuestro equipo. Recibirás una confirmación por WhatsApp cuando esté listo para recoger." 
                                   FontSize="16" 
                                   TextColor="Gray"
                                   HorizontalTextAlignment="Center"
                                   Margin="0,20,0,0"/>

                            <Frame BackgroundColor="{StaticResource backgroundColor}" 
                                   CornerRadius="8" 
                                   HasShadow="False"
                                   Padding="15"
                                   Margin="0,20,0,0">
                                <StackLayout>
                                    <Label Text="⏱️ Tiempo estimado:" 
                                           FontSize="14" 
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"/>
                                    <Label Text="5-10 minutos" 
                                           FontSize="12" 
                                           TextColor="Gray"
                                           HorizontalOptions="Center"/>
                                </StackLayout>
                            </Frame>
                        </StackLayout>
                    </Frame>

                    <!-- Contact Info -->
                    <Label Text="¿Tienes preguntas? Contáctanos al 8888-8888" 
                           FontSize="12" 
                           TextColor="Gray"
                           HorizontalTextAlignment="Center"
                           Margin="0,20,0,0"/>
                </StackLayout>

            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>