<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SaborSostenibleFrontEnd.BuySupriseBagPage"
             Title="Bolsa Sorpresa"
             BackgroundColor="{StaticResource backgroundColor}">

    <ScrollView>
        <StackLayout Padding="20" Spacing="30">

            <!-- Indicador visual de pasos -->
            <Grid ColumnSpacing="0" RowSpacing="0" HorizontalOptions="FillAndExpand" HeightRequest="60">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <StackLayout Grid.Column="0" HorizontalOptions="Center">
                    <Frame x:Name="Paso1Icon" WidthRequest="30" HeightRequest="30" CornerRadius="15"
                           BackgroundColor="{StaticResource Primary}" HasShadow="True" Padding="0" HorizontalOptions="Center">
                        <Label Text="1" HorizontalOptions="Center" VerticalOptions="Center" TextColor="White" FontAttributes="Bold" />
                    </Frame>
                    <Label Text="Confirmar" FontSize="12" TextColor="Black" HorizontalOptions="Center" />
                </StackLayout>

                <StackLayout Grid.Column="1" HorizontalOptions="Center">
                    <Frame x:Name="Paso2Icon" WidthRequest="30" HeightRequest="30" CornerRadius="15"
                           BackgroundColor="LightGray" HasShadow="True" Padding="0" HorizontalOptions="Center">
                        <Label Text="2" HorizontalOptions="Center" VerticalOptions="Center" TextColor="White" FontAttributes="Bold" />
                    </Frame>
                    <Label Text="Pago" FontSize="12" TextColor="Black" HorizontalOptions="Center" />
                </StackLayout>

                <StackLayout Grid.Column="2" HorizontalOptions="Center">
                    <Frame x:Name="Paso3Icon" WidthRequest="30" HeightRequest="30" CornerRadius="15"
                           BackgroundColor="LightGray" HasShadow="True" Padding="0" HorizontalOptions="Center">
                        <Label Text="3" HorizontalOptions="Center" VerticalOptions="Center" TextColor="White" FontAttributes="Bold" />
                    </Frame>
                    <Label Text="Final" FontSize="12" TextColor="Black" HorizontalOptions="Center" />
                </StackLayout>
            </Grid>

            <!-- Paso 1 -->
            <Frame x:Name="CompraStep" IsVisible="True" CornerRadius="20" BackgroundColor="White" HasShadow="True" Padding="20" BorderColor="Transparent">
                <StackLayout Spacing="15">
                    <Label Text="Confirmar compra en:" FontSize="18" FontAttributes="Bold" TextColor="Black" />
                    <Label x:Name="RestauranteNombreLabel" FontSize="22" FontAttributes="Bold" TextColor="{StaticResource Tertiary}" />
                    <Label x:Name="RestauranteDescripcionLabel" FontSize="14" TextColor="Black" />
                    <Image x:Name="RestauranteImagen" HeightRequest="120" Aspect="AspectFill" Margin="0,10" />

                    <Label Text="Tu número de teléfono" FontSize="14" FontAttributes="Bold" TextColor="Black" />
                    <Frame BackgroundColor="#F0F0F0" CornerRadius="10" HasShadow="False" Padding="10">
                        <Entry x:Name="CustomerPhoneEntry" Placeholder="8888-8888" Keyboard="Telephone"
                               TextColor="Black" BackgroundColor="Transparent" />
                    </Frame>

                    <Button Text="Proceder con compra" Clicked="OnProcederCompraClicked"
                            BackgroundColor="{StaticResource Primary}" TextColor="White"
                            CornerRadius="12" Padding="12" />
                </StackLayout>
            </Frame>

            <!-- Paso 2 -->
            <Frame x:Name="InstruccionesStep" IsVisible="False" CornerRadius="20" BackgroundColor="White" HasShadow="True" Padding="20" BorderColor="Transparent">
                <StackLayout Spacing="15">
                    <Label Text="Instrucciones para completar tu compra" FontSize="18" FontAttributes="Bold" TextColor="Black" />

                    <Label Text="1. Abre SINPE Móvil" FontSize="14" TextColor="Black" />
                    <Label Text="2. Envía el pago al número:" FontSize="14" TextColor="Black" />
                    <Label x:Name="RestauranteTelefonoLabel" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource Tertiary}" />

                    <Label Text="3. Detalle del pago (puedes copiarlo):" FontSize="14" TextColor="Black" />

                    <Frame BackgroundColor="#F0F0F0" Padding="10" CornerRadius="10">
                        <StackLayout>
                            <Label x:Name="SinpeDetalleLabel" FontSize="12" TextColor="Black" />
                            <Button Text="Copiar" Clicked="OnCopiarDetalleClicked"
                                    BackgroundColor="{StaticResource Secondary}" TextColor="White"
                                    CornerRadius="8" Padding="6" HorizontalOptions="End" />
                        </StackLayout>
                    </Frame>

                    <Label Text="4. Envía el comprobante al WhatsApp del restaurante." FontSize="14" TextColor="Black" />

                    <Button Text="Confirmar" Clicked="OnFinalizarClicked"
                            BackgroundColor="{StaticResource Primary}" TextColor="White"
                            CornerRadius="12" Padding="12" />
                </StackLayout>
            </Frame>

            <!-- Paso 3 -->
            <Frame x:Name="ConfirmacionStep" IsVisible="False" CornerRadius="20" BackgroundColor="White" HasShadow="True" Padding="20" BorderColor="Transparent">
                <StackLayout Spacing="15">
                    <Label Text="¡Compra en proceso!" FontSize="22" FontAttributes="Bold" TextColor="{StaticResource Primary}" />

                    <Label Text="Código de orden:" FontSize="14" TextColor="Black" />
                    <Label x:Name="OrdenFinalLabel" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource Tertiary}" />

                    <Label Text="Número de empresa:" FontSize="14" TextColor="Black" />
                    <Label x:Name="TelefonoFinalLabel" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource Tertiary}" />

                    <Label Text="Estado actual:" FontSize="14" TextColor="Black" />
                    <ActivityIndicator IsRunning="True" Color="{StaticResource Primary}" />

                    <Button Text="Volver al inicio" Clicked="OnVolverInicioClicked"
                            BackgroundColor="{StaticResource Primary}" TextColor="White"
                            CornerRadius="12" Padding="12" Margin="0,20,0,0" />
                </StackLayout>
            </Frame>
        </StackLayout>
    </ScrollView>

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="←" Order="Primary" Priority="0" Clicked="OnBackButtonClicked" />
    </ContentPage.ToolbarItems>
</ContentPage>
